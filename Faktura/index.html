<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fakturaƒçn√≠ aplikace - Komponentov√° verze</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <div id="header-container"></div>
        <main class="main-content">
            <div id="form-container"></div>
            <div id="list-container"></div>
        </main>
    </div>
    <div id="notifications-container"></div>
    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM naƒçten, spou≈°t√≠m naƒç√≠t√°n√≠ komponent≈Ø...');
            loadScript('components/header.js', function() {
                console.log('‚úÖ header.js naƒçten');
                loadScript('components/invoice-card.js', function() {
                    console.log('‚úÖ invoice-card.js naƒçten');
                    loadScript('components/invoice-list.js', function() {
                        console.log('‚úÖ invoice-list.js naƒçten');
                        loadScript('components/invoice-form.js', function() {
                            console.log('‚úÖ invoice-form.js naƒçten');
                            console.log('üéâ V≈°echny komponenty naƒçteny, spou≈°t√≠m aplikaci...');
                            initApp();
                        });
                    });
                });
            });
        });
        function loadScript(src, callback) {
            const script = document.createElement('script');
            script.src = src;
            script.onload = function() {
                console.log(`üì¶ Script naƒçten: ${src}`);
                if (callback) callback();
            };
            script.onerror = function() {
                console.error(`‚ùå Chyba p≈ôi naƒç√≠t√°n√≠: ${src}`);
            };
            document.head.appendChild(script);
        }
        function initApp() {
            console.log('üöÄ Inicializuji aplikaci...');
            const requiredComponents = ['HeaderComponent', 'InvoiceCardComponent', 'InvoiceListComponent', 'InvoiceFormComponent'];
            const missing = requiredComponents.filter(name => !window[name]);
            if (missing.length > 0) {
                console.error('‚ùå Chybƒõj√≠c√≠ komponenty:', missing);
                alert('Chyba: Nƒõkter√© komponenty se nenaƒçetly: ' + missing.join(', '));
                return;
            }
            try {
                if (!window.AppState) throw new Error('AppState chyb√≠');
                if (!window.ComponentSystem) throw new Error('ComponentSystem chyb√≠');
                console.log('üìÇ Naƒç√≠t√°m data z localStorage...');
                AppState.loadFromStorage();
                
                // Pokud nejsou ≈æ√°dn√© faktury, p≈ôidej testovac√≠ data
                if (AppState.invoices.length === 0) {
                    console.log('üìù P≈ôid√°v√°m testovac√≠ data...');
                    AppState.addTestData();
                }
                
                console.log('üî® Vytv√°≈ô√≠m komponenty...');
                Promise.all([
                    ComponentSystem.createComponent('header', 'header-container'),
                    ComponentSystem.createComponent('invoice-form', 'form-container'),
                    ComponentSystem.createComponent('invoice-list', 'list-container')
                ]).then(() => {
                    console.log('‚úÖ V≈°echny komponenty vytvo≈ôeny');
                    AppState.updateStats();
                    AppState.changeSection('form');
                    console.log('üéâ Aplikace √∫spƒõ≈°nƒõ spu≈°tƒõna!');
                    showNotification('Aplikace je p≈ôipravena!', 'success');
                }).catch(error => {
                    console.error('‚ùå Chyba p≈ôi vytv√°≈ôen√≠ komponent≈Ø:', error);
                    console.error('Error details:', error);
                    showNotification('Chyba p≈ôi vytv√°≈ôen√≠ komponent≈Ø: ' + error.message, 'error');
                    alert('Chyba p≈ôi vytv√°≈ôen√≠ komponent≈Ø: ' + error.message);
                });
            } catch (error) {
                console.error('‚ùå Chyba p≈ôi inicializaci:', error);
                console.error('Error details:', error);
                showNotification('Chyba p≈ôi spu≈°tƒõn√≠: ' + error.message, 'error');
                alert('Chyba p≈ôi spu≈°tƒõn√≠: ' + error.message);
            }
        }
    </script>
</body>
</html>